name: Publish LASER System

on:
  push:
    branches: [ "32" ]
  pull_request:
    branches: [ "32" ]

jobs:

  build:
  
    runs-on: windows-latest 

    env:
      Solution_Name: "LASER System.sln"
      Folder_Name: LASER System                       
      Branch: development
      version: 2.0.3.11
      
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Chocolatey 
        uses: crazy-max/ghaction-chocolatey@v3
        with:
          args: -h
        
      - name: Install Crystal Report
        run: choco install crystalreports-for-visualstudio
        
      - name: Setup MSBuild.exe
        uses: microsoft/setup-msbuild@v1.0.2
  
      - name: Setup Nuget
        uses: nuget/setup-nuget@v1
        with: 
          nuget-version: latest 
  
      - name: Restore NuGet Packages
        run: nuget restore
  
      - name: Build LASER System Project      
        working-directory: "./LASER System"
        run: msbuild 
  
      - name: Publish LASER System Project
        working-directory: "./LASER System"
        run: msbuild /t:publish /p:PublishDir="publish/" /property:UpdateEnabled=true /property:UpdateUrl="https://raw.githubusercontent.com/MaleeshaRodrigo/LASERSystem/${{env.Branch}}/LASER%20System/publish/"  /p:configuration="Release" /p:ApplicationVersion=${{env.Version}}
        
      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v3.1.3
        with:
          path: LASER System\publish\
